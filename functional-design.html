<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>機能設計書 - Zoom Memo Automation v2.0</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            border-bottom: 2px solid #667eea;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #667eea;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .nav {
            background: #667eea;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        .nav a {
            color: white;
            text-decoration: none;
            margin-right: 20px;
            padding: 5px 10px;
            border-radius: 3px;
            transition: background 0.3s;
        }
        
        .nav a:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        
        .section h2 {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .function-card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .function-card h3 {
            color: #495057;
            margin-top: 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-planned { background: #ffc107; }
        .status-development { background: #007bff; }
        .status-completed { background: #28a745; }
        .status-testing { background: #fd7e14; }
        .status-new { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        
        .requirement-list {
            background: #e7f3ff;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 15px 0;
        }
        
        .new-feature {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .architecture-diagram {
            background: #2d3436;
            color: #dfe6e9;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
        }
        
        .architecture-diagram .new {
            color: #55efc4;
            font-weight: bold;
        }
        
        .architecture-diagram .modified {
            color: #fdcb6e;
            font-weight: bold;
        }
        
        .architecture-diagram .deprecated {
            color: #636e72;
            text-decoration: line-through;
        }
        
        .performance-table {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .performance-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .performance-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px;
            text-align: left;
        }
        
        .performance-table td {
            padding: 10px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .improvement {
            color: #00b894;
            font-weight: bold;
        }
        
        .migration-timeline {
            background: #fff;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .timeline-item {
            display: flex;
            margin: 15px 0;
            align-items: center;
        }
        
        .timeline-marker {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 20px;
            flex-shrink: 0;
        }
        
        .timeline-content {
            flex: 1;
        }
        
        .last-updated {
            text-align: right;
            color: #666;
            font-size: 0.9rem;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background: #667eea;
            color: white;
        }
        
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .warning-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .success-box {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📋 機能設計書 <span class="version-badge">v2.0</span></h1>
            <p>Zoom Memo Automation システム - Transcript API対応版</p>
        </div>
        
        <div class="nav">
            <a href="index.html">🏠 ダッシュボード</a>
            <a href="business-design.html">📋 業務設計書</a>
            <a href="environment-design.html">🏗️ 環境設計書</a>
            <a href="operations-design.html">🛠️ 運用設計書</a>
            <a href="test-specification.html">🧪 テスト仕様書</a>
            <a href="error-codes.html">❌ エラーコード</a>
        </div>
        
        <div class="section">
            <h2>1. システム概要 v2.0</h2>
            <p>Zoom Memo Automation v2.0は、Zoom Transcript APIを活用して、文字起こし処理を大幅に効率化した次世代システムです。</p>
            
            <div class="new-feature">
                <h4>🎯 v2.0 革新的変更点</h4>
                <ul>
                    <li><strong>Zoom Transcript API統合:</strong> Zoom自動生成の高精度文字起こしデータ（VTT形式）を直接取得</li>
                    <li><strong>処理時間90%削減:</strong> 5-10分 → 30秒-1分へ短縮</li>
                    <li><strong>コスト80%削減:</strong> Gemini文字起こし処理が不要に</li>
                    <li><strong>17分制限撤廃:</strong> Gemini処理制限を回避、60分会議も完全対応</li>
                    <li><strong>精度向上:</strong> Zoom自動生成の高精度文字起こしを活用</li>
                </ul>
            </div>
            
            <div class="architecture-diagram">
                <strong>【v2.0 アーキテクチャ構造】</strong><br/><br/>
                <strong>📋 monitor-recordings-production.js</strong> (本番エントリーポイント)<br/>
                &nbsp;&nbsp;↓<br/>
                📥 <strong>ZoomRecordingService</strong> - 組織全体録画データ取得・処理<br/>
                &nbsp;&nbsp;↓<br/>
                <span class="new">📝 TranscriptService - Zoom VTTトランスクリプト取得・解析 [NEW]</span><br/>
                &nbsp;&nbsp;↓ (トランスクリプトあり) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↓ (フォールバック)<br/>
                <span class="modified">🤖 AIService - 要約生成のみ [MODIFIED]</span> &nbsp;&nbsp;<span class="deprecated">🎵 AudioSummaryService</span><br/>
                &nbsp;&nbsp;↓<br/>
                💾 <strong>VideoStorageService</strong> - Google Drive保存・共有リンク<br/>
                &nbsp;&nbsp;↓<br/>
                📄 <strong>DocumentStorageService</strong> - 文字起こし・要約保存<br/>
                &nbsp;&nbsp;↓<br/>
                💬 <strong>SlackService</strong> - 構造化投稿<br/>
            </div>
        </div>
        
        <div class="section">
            <h2>2. 新規コア機能（v2.0）</h2>
            
            <div class="function-card">
                <h3><span class="status-indicator status-new"></span>T001: TranscriptService（文字起こし取得部品）</h3>
                <p><strong>説明:</strong> Zoom Recording APIから自動生成された文字起こしデータ（VTT形式）を取得・解析する新規サービス</p>
                <p><strong>実装場所:</strong> 1.src/services/transcriptService.js（新規作成）</p>
                <p><strong>状態:</strong> 🆕 設計完了・実装待ち</p>
                
                <h4>主要メソッド</h4>
                <table>
                    <tr>
                        <th>メソッド名</th>
                        <th>機能</th>
                        <th>戻り値</th>
                    </tr>
                    <tr>
                        <td>downloadTranscript(recording)</td>
                        <td>録画データからVTTファイルを取得</td>
                        <td>VTTコンテンツ or null</td>
                    </tr>
                    <tr>
                        <td>parseVTT(vttContent)</td>
                        <td>VTT形式を解析してテキスト抽出</td>
                        <td>{fullText, speakers, timestamps}</td>
                    </tr>
                    <tr>
                        <td>hasTranscript(recording)</td>
                        <td>トランスクリプト有無判定</td>
                        <td>boolean</td>
                    </tr>
                    <tr>
                        <td>extractSpeakers(vttContent)</td>
                        <td>発言者情報の抽出</td>
                        <td>Array&lt;Speaker&gt;</td>
                    </tr>
                </table>
                
                <h4>VTTファイル処理仕様</h4>
                <table>
                    <tr>
                        <th>項目</th>
                        <th>仕様</th>
                    </tr>
                    <tr>
                        <td>取得形式</td>
                        <td>WebVTT（Web Video Text Tracks）形式</td>
                    </tr>
                    <tr>
                        <td>文字コード</td>
                        <td>UTF-8</td>
                    </tr>
                    <tr>
                        <td>タイムスタンプ</td>
                        <td>HH:MM:SS.mmm形式を保持・除去可能</td>
                    </tr>
                    <tr>
                        <td>スピーカー識別</td>
                        <td>話者名を抽出して構造化</td>
                    </tr>
                    <tr>
                        <td>エラーハンドリング</td>
                        <td>VTT解析失敗時は音声処理へフォールバック</td>
                    </tr>
                </table>
            </div>
            
            <div class="function-card">
                <h3><span class="status-indicator status-new"></span>A001: AIService拡張（要約専用モード）</h3>
                <p><strong>説明:</strong> 文字起こし済みテキストから要約のみを生成する高速処理モード</p>
                <p><strong>実装場所:</strong> 1.src/services/aiService.js（既存拡張）</p>
                <p><strong>状態:</strong> 🆕 設計完了・実装待ち</p>
                
                <h4>新規メソッド</h4>
                <table>
                    <tr>
                        <th>メソッド名</th>
                        <th>機能</th>
                        <th>処理時間</th>
                    </tr>
                    <tr>
                        <td>generateSummaryFromText(text)</td>
                        <td>テキストから8項目要約生成</td>
                        <td>10-30秒</td>
                    </tr>
                    <tr>
                        <td>getSummaryOnlyModel()</td>
                        <td>要約専用軽量モデル選択</td>
                        <td>即座</td>
                    </tr>
                    <tr>
                        <td>optimizeSummaryPrompt(text)</td>
                        <td>要約用プロンプト最適化</td>
                        <td>即座</td>
                    </tr>
                </table>
            </div>
        </div>
        
        <div class="section">
            <h2>3. 更新されるコア機能（v2.0）</h2>
            
            <div class="function-card">
                <h3><span class="status-indicator status-completed"></span>P001: ZoomRecordingService（拡張）</h3>
                <p><strong>説明:</strong> Transcript API対応を追加した録画処理サービス</p>
                <p><strong>実装場所:</strong> 1.src/services/zoomRecordingService.js</p>
                <p><strong>状態:</strong> ⚡ 設計完了・更新待ち</p>
                
                <div class="new-feature">
                    <h4>v2.0 処理フロー変更</h4>
                    <ol>
                        <li><strong>録画データ取得:</strong> recording_filesからTRANSCRIPTファイルを優先検索</li>
                        <li><strong>Transcript処理:</strong> VTTファイルがあれば高速パス実行</li>
                        <li><strong>フォールバック:</strong> VTTなしの場合は従来の音声処理</li>
                        <li><strong>統合処理:</strong> 両パスの結果を統一フォーマットで返却</li>
                    </ol>
                </div>
                
                <h4>更新メソッド</h4>
                <table>
                    <tr>
                        <th>メソッド名</th>
                        <th>変更内容</th>
                        <th>影響範囲</th>
                    </tr>
                    <tr>
                        <td>processRecording()</td>
                        <td>Transcript優先処理を追加</td>
                        <td>高</td>
                    </tr>
                    <tr>
                        <td>extractRecordingFiles()</td>
                        <td>TRANSCRIPTファイル種別追加</td>
                        <td>中</td>
                    </tr>
                    <tr>
                        <td>selectProcessingPath()</td>
                        <td>処理パス選択ロジック（新規）</td>
                        <td>新規</td>
                    </tr>
                </table>
            </div>
            
            <div class="function-card">
                <h3><span class="status-indicator status-completed"></span>P002: AudioSummaryService（縮小）</h3>
                <p><strong>説明:</strong> フォールバック専用として維持される音声処理サービス</p>
                <p><strong>実装場所:</strong> 1.src/services/audioSummaryService.js</p>
                <p><strong>状態:</strong> ⚠️ フォールバック専用へ移行</p>
                
                <div class="warning-box">
                    <strong>⚠️ 重要:</strong> v2.0では主要処理パスから除外され、以下の場合のみ使用：
                    <ul>
                        <li>古い録画でTranscriptが利用不可</li>
                        <li>Zoom設定で文字起こしが無効</li>
                        <li>VTTファイル取得/解析エラー時</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>4. パフォーマンス比較</h2>
            
            <div class="performance-table">
                <table>
                    <tr>
                        <th>測定項目</th>
                        <th>v1.0（音声処理）</th>
                        <th>v2.0（Transcript API）</th>
                        <th>改善率</th>
                    </tr>
                    <tr>
                        <td>30分会議の処理時間</td>
                        <td>5-10分</td>
                        <td class="improvement">30秒-1分</td>
                        <td class="improvement">90%削減</td>
                    </tr>
                    <tr>
                        <td>60分会議の処理時間</td>
                        <td>17分で途切れ</td>
                        <td class="improvement">1-2分（完全対応）</td>
                        <td class="improvement">∞</td>
                    </tr>
                    <tr>
                        <td>Gemini API使用量</td>
                        <td>音声+要約</td>
                        <td class="improvement">要約のみ</td>
                        <td class="improvement">80%削減</td>
                    </tr>
                    <tr>
                        <td>処理成功率</td>
                        <td>85%（タイムアウトあり）</td>
                        <td class="improvement">99%</td>
                        <td class="improvement">14%向上</td>
                    </tr>
                    <tr>
                        <td>文字起こし精度</td>
                        <td>Gemini依存</td>
                        <td class="improvement">Zoom高精度</td>
                        <td class="improvement">向上</td>
                    </tr>
                </table>
            </div>
        </div>
        
        <div class="section">
            <h2>5. 移行計画</h2>
            
            <div class="migration-timeline">
                <h3>📅 段階的移行スケジュール</h3>
                
                <div class="timeline-item">
                    <div class="timeline-marker">1</div>
                    <div class="timeline-content">
                        <h4>Stage 1: 並行実装（現在）</h4>
                        <p>TranscriptServiceを新規実装し、既存処理と並行動作可能な状態を構築</p>
                        <ul>
                            <li>transcriptService.js新規作成</li>
                            <li>aiService.jsに要約専用メソッド追加</li>
                            <li>設定フラグで切替可能に</li>
                        </ul>
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-marker">2</div>
                    <div class="timeline-content">
                        <h4>Stage 2: A/Bテスト（1週間）</h4>
                        <p>10%のトラフィックで新処理を検証、段階的に増加</p>
                        <ul>
                            <li>メトリクス収集（処理時間、成功率）</li>
                            <li>エラー率モニタリング</li>
                            <li>コスト削減効果測定</li>
                        </ul>
                    </div>
                </div>
                
                <div class="timeline-item">
                    <div class="timeline-marker">3</div>
                    <div class="timeline-content">
                        <h4>Stage 3: 完全移行（2週間後）</h4>
                        <p>Transcript APIを主要処理パスとして確立</p>
                        <ul>
                            <li>音声処理をフォールバック専用化</li>
                            <li>不要コードの段階的削除</li>
                            <li>ドキュメント最終更新</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>6. リスク管理</h2>
            
            <div class="function-card">
                <h3>想定リスクと対策</h3>
                <table>
                    <tr>
                        <th>リスク</th>
                        <th>影響度</th>
                        <th>対策</th>
                    </tr>
                    <tr>
                        <td>Transcriptが利用不可</td>
                        <td>中</td>
                        <td>音声処理へ自動フォールバック</td>
                    </tr>
                    <tr>
                        <td>VTT解析エラー</td>
                        <td>低</td>
                        <td>エラーハンドリングとフォールバック</td>
                    </tr>
                    <tr>
                        <td>文字コード問題</td>
                        <td>低</td>
                        <td>UTF-8強制、文字コード検出</td>
                    </tr>
                    <tr>
                        <td>API仕様変更</td>
                        <td>中</td>
                        <td>バージョン固定、変更監視</td>
                    </tr>
                </table>
            </div>
        </div>
        
        <div class="section">
            <h2>7. 技術仕様更新</h2>
            
            <div class="function-card">
                <h3>🛠️ 技術スタック v2.0</h3>
                <table>
                    <tr>
                        <th>カテゴリ</th>
                        <th>v1.0</th>
                        <th>v2.0</th>
                        <th>変更点</th>
                    </tr>
                    <tr>
                        <td>文字起こし</td>
                        <td>Gemini AI</td>
                        <td class="improvement">Zoom Transcript API</td>
                        <td>新規追加</td>
                    </tr>
                    <tr>
                        <td>要約生成</td>
                        <td>Gemini 2.5 Pro</td>
                        <td>Gemini 2.5 Flash</td>
                        <td>軽量化</td>
                    </tr>
                    <tr>
                        <td>データ形式</td>
                        <td>M4A/MP3音声</td>
                        <td class="improvement">VTTテキスト</td>
                        <td>形式変更</td>
                    </tr>
                    <tr>
                        <td>処理パイプライン</td>
                        <td>シーケンシャル</td>
                        <td class="improvement">分岐処理</td>
                        <td>最適化</td>
                    </tr>
                </table>
            </div>
            
            <div class="success-box">
                <h4>✅ v2.0の主要メリット</h4>
                <ul>
                    <li><strong>即座性:</strong> リアルタイムに近い処理速度</li>
                    <li><strong>経済性:</strong> API利用料の大幅削減</li>
                    <li><strong>信頼性:</strong> タイムアウトリスクの解消</li>
                    <li><strong>拡張性:</strong> 60分以上の長時間会議にも対応</li>
                    <li><strong>保守性:</strong> シンプルな処理フローによる保守性向上</li>
                </ul>
            </div>
        </div>
        
        <div class="last-updated">
            最終更新: 2025年9月26日 | v2.0設計 - Zoom Transcript API統合による革新的パフォーマンス改善
        </div>
    </div>

</body>
</html>