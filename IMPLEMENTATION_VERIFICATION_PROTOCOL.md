# 実装確認プロトコル（要件ミス防止）

## 🎯 目的
Claude Codeによる要件理解ミスと実装乖離を防止し、ユーザーの明示的な要求を確実に実装する。

## 📋 必須プロトコル

### Phase 1: 要件理解確認（実装前必須）

#### 1.1 要件の逐語的引用
```
【ユーザーの原文】
「完全文字起こし処理→文字起こし完了後に要約」

【理解内容】
- 全チャンクの文字起こしを完了
- 完了後に一括で要約生成
- チャンク単位での要約生成は行わない
```

#### 1.2 実装方針の明文化
```
【実装方針】
1. processIndividualChunk: 文字起こしのみ実行
2. processAudioInChunks: 全文字起こし結合→一括要約
3. flowType: 'true-2stage-processing'

【確認事項】
- この方針で要件を満たしているか？
- 不明確な点はないか？
```

#### 1.3 事前確認の強制
- **実装開始前にユーザーに確認を取る**
- 曖昧な表現は必ず質問する
- 独自解釈での実装は禁止

### Phase 2: 実装後検証（コミット前必須）

#### 2.1 要件適合性チェック
```bash
# 実装コード確認
grep -n "generateSummaryFromTranscription" src/services/audioSummaryService.js
# → チャンク内で呼び出されていないことを確認

# フロー確認
grep -n "true-2stage-processing" src/services/audioSummaryService.js
# → 正しいフロータイプが設定されていることを確認
```

#### 2.2 Todo項目との照合
- 各Todo項目が要件通りに実装されているか逐一確認
- 形式的な完了ではなく、実質的な完了を検証

#### 2.3 破壊的変更の影響確認
```bash
# 変更前後の処理フロー比較
git diff HEAD~1 -- src/services/audioSummaryService.js | grep -A5 -B5 "generateSummaryFromTranscription"
```

### Phase 3: 報告プロトコル

#### 3.1 実装報告の必須項目
1. **要件理解**: ユーザー要求の逐語的引用
2. **実装内容**: 具体的な変更点
3. **検証結果**: 要件適合性の確認
4. **影響範囲**: 既存機能への影響
5. **テスト方針**: 検証方法の提案

#### 3.2 間違い発生時の報告
1. **原因分析**: なぜ間違いが発生したか
2. **影響範囲**: どの部分が影響を受けたか
3. **修正内容**: 具体的な修正方法
4. **再発防止**: 同様の間違いを防ぐ方法

## ⚠️ 違反防止の強制ルール

### 絶対禁止事項
1. **要件の独自解釈**: ユーザーの明示的な指示を勝手に変更
2. **事前確認なしの実装**: 曖昧な要件での実装開始
3. **形式的なTodo完了**: 実質的な検証なしでの完了扱い
4. **検証プロセスの省略**: 実装後の要件適合性チェック省略

### 強制実行項目
1. **実装前確認**: 必ずユーザーに実装方針を確認
2. **コード検証**: grep等でのコード動作確認
3. **影響範囲調査**: 既存機能への影響評価
4. **詳細報告**: 5項目の報告を必ず実施

## 📊 検証チェックリスト

### 実装前チェック
- [ ] ユーザー要求を逐語的に引用した
- [ ] 実装方針を明文化した
- [ ] 曖昧な点をユーザーに確認した
- [ ] Todo項目と実装方針が一致している

### 実装後チェック
- [ ] 要件適合性をコードレベルで確認した
- [ ] 既存機能への影響を評価した
- [ ] フロータイプ等の識別子が正しく設定されている
- [ ] テストケースで動作確認可能

### 報告前チェック
- [ ] 5項目の報告内容を準備した
- [ ] 間違いがあった場合は原因分析を完了した
- [ ] 再発防止策を具体的に提案した
- [ ] ユーザーが理解しやすい形で整理した

---

**最終更新:** 2025-09-23
**適用開始:** 即時
**責任者:** Claude Code
**確認者:** 全てのコード実装作業で必須適用