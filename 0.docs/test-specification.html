<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>テスト仕様書 - Zoom Memo Automation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background: #f5f5f5;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            border-bottom: 2px solid #fd7e14;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #fd7e14;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .nav {
            background: #fd7e14;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        .nav a {
            color: white;
            text-decoration: none;
            margin-right: 20px;
            padding: 5px 10px;
            border-radius: 3px;
            transition: background 0.3s;
        }
        
        .nav a:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        
        .section h2 {
            color: #333;
            border-bottom: 2px solid #fd7e14;
            padding-bottom: 10px;
        }
        
        .test-case {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .test-case h3 {
            color: #495057;
            margin-top: 0;
        }
        
        .test-level {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .level-card {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
        }
        
        .level-card h4 {
            color: #856404;
            margin-top: 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-not-started { background: #dc3545; }
        .status-in-progress { background: #ffc107; }
        .status-completed { background: #28a745; }
        .status-blocked { background: #6c757d; }
        
        .test-matrix {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            min-width: 600px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background: #fd7e14;
            color: white;
        }
        
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        .priority-high { background: #f8d7da; }
        .priority-medium { background: #fff3cd; }
        .priority-low { background: #d4edda; }
        
        .test-data-section {
            background: #e7f3ff;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 15px 0;
        }
        
        .automation-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .last-updated {
            text-align: right;
            color: #666;
            font-size: 0.9rem;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧪 テスト仕様書</h1>
            <p>Zoom Memo Automation システムテスト計画</p>
        </div>
        
        <div class="nav">
            <a href="index.html">🏠 ダッシュボード</a>
            <a href="functional-design.html">📋 機能設計書</a>
            <a href="environment-design.html">🏗️ 環境設計書</a>
            <a href="claude.md">💬 対話記録</a>
        </div>
        
        <div class="section">
            <h2>1. テスト戦略</h2>
            
            <h3>テストレベル構成</h3>
            <div class="test-level">
                <div class="level-card">
                    <h4>ユニットテスト</h4>
                    <p>個別コンポーネント・関数のテスト</p>
                    <p><strong>カバレッジ目標:</strong> 80%以上</p>
                    <p><strong>フレームワーク:</strong> Jest, React Testing Library</p>
                </div>
                
                <div class="level-card">
                    <h4>統合テスト</h4>
                    <p>APIエンドポイントと外部サービス連携のテスト</p>
                    <p><strong>カバレッジ目標:</strong> 主要フロー100%</p>
                    <p><strong>フレームワーク:</strong> Supertest, Nock</p>
                </div>
                
                <div class="level-card">
                    <h4>E2Eテスト</h4>
                    <p>実際のユーザーシナリオに基づくテスト</p>
                    <p><strong>カバレッジ目標:</strong> 重要シナリオ100%</p>
                    <p><strong>フレームワーク:</strong> Playwright</p>
                </div>
                
                <div class="level-card">
                    <h4>性能テスト</h4>
                    <p>負荷・ストレステスト</p>
                    <p><strong>目標:</strong> レスポンス時間 < 3秒</p>
                    <p><strong>ツール:</strong> Artillery, Lighthouse</p>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>2. テストケース</h2>
            
            <div class="test-case">
                <h3><span class="status-indicator status-completed"></span>TC001: Zoom Cloud Recording監視テスト</h3>
                <div class="test-matrix">
                    <table>
                        <tr>
                            <th>項目</th>
                            <th>内容</th>
                        </tr>
                        <tr>
                            <td>目的</td>
                            <td>Zoom Cloud Recording APIから新しい録画を正常に検知・ダウンロードできることを確認</td>
                        </tr>
                        <tr>
                            <td>前提条件</td>
                            <td>Zoom API認証情報設定済み、テスト用録画データ存在</td>
                        </tr>
                        <tr>
                            <td>テスト手順</td>
                            <td>
                                1. monitorNewRecordings()を呼び出し<br>
                                2. 新しい録画の検知を確認<br>
                                3. 音声・動画ファイルのダウンロードを確認<br>
                                4. ファイルサイズ・形式の検証
                            </td>
                        </tr>
                        <tr>
                            <td>期待結果</td>
                            <td>M4A/MP4ファイルダウンロード成功、適切なメタデータ取得</td>
                        </tr>
                        <tr class="priority-high">
                            <td>優先度</td>
                            <td>高</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="test-case">
                <h3><span class="status-indicator status-completed"></span>TC002: Gemini AI文字起こしテスト</h3>
                <div class="test-matrix">
                    <table>
                        <tr>
                            <th>項目</th>
                            <th>内容</th>
                        </tr>
                        <tr>
                            <td>目的</td>
                            <td>Google Gemini APIで音声ファイルを正しく日本語テキストに変換できることを確認</td>
                        </tr>
                        <tr>
                            <td>前提条件</td>
                            <td>Google AI API キー設定済み、Gemini 2.5 Pro利用可能</td>
                        </tr>
                        <tr>
                            <td>テスト手順</td>
                            <td>
                                1. テスト用音声ファイル（M4A/MP4）を準備<br>
                                2. transcribeAudio()を呼び出し<br>
                                3. 動的モデル選択の動作確認<br>
                                4. 日本語文字起こし精度の検証
                            </td>
                        </tr>
                        <tr>
                            <td>期待結果</td>
                            <td>日本語音声内容の90%以上が正確にテキスト化、話者識別機能動作</td>
                        </tr>
                        <tr class="priority-high">
                            <td>優先度</td>
                            <td>高</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="test-case">
                <h3><span class="status-indicator status-completed"></span>TC003: Gemini AI議事録生成テスト</h3>
                <div class="test-matrix">
                    <table>
                        <tr>
                            <th>項目</th>
                            <th>内容</th>
                        </tr>
                        <tr>
                            <td>目的</td>
                            <td>文字起こしテキストから構造化された日本語議事録が生成されることを確認</td>
                        </tr>
                        <tr>
                            <td>前提条件</td>
                            <td>会議文字起こしデータが準備済み、Gemini API利用可能</td>
                        </tr>
                        <tr>
                            <td>テスト手順</td>
                            <td>
                                1. サンプル会議文字起こしテキストを入力<br>
                                2. analyzeComprehensively()を呼び出し<br>
                                3. 生成された議事録のMarkdown構造を確認<br>
                                4. 決定事項・アクションアイテム抽出を検証
                            </td>
                        </tr>
                        <tr>
                            <td>期待結果</td>
                            <td>基本情報、議論内容、決定事項、Next Action & Due Dateが適切に整理される</td>
                        </tr>
                        <tr class="priority-high">
                            <td>優先度</td>
                            <td>高</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="test-case">
                <h3><span class="status-indicator status-completed"></span>TC004: Google Drive保存・共有テスト</h3>
                <div class="test-matrix">
                    <table>
                        <tr>
                            <th>項目</th>
                            <th>内容</th>
                        </tr>
                        <tr>
                            <td>目的</td>
                            <td>録画ファイルのGoogle Drive保存と共有リンク生成が正常に動作することを確認</td>
                        </tr>
                        <tr>
                            <td>前提条件</td>
                            <td>Google Drive API認証情報設定済み、サービスアカウント権限設定</td>
                        </tr>
                        <tr>
                            <td>テスト手順</td>
                            <td>
                                1. saveRecording()でMP4/M4Aファイルをアップロード<br>
                                2. 年/月フォルダ構造の自動作成確認<br>
                                3. 組織ドメイン共有リンク生成確認<br>
                                4. ファイル名・説明文の適切な生成確認
                            </td>
                        </tr>
                        <tr>
                            <td>期待結果</td>
                            <td>ファイル保存成功、視聴可能な共有リンク生成、適切なメタデータ</td>
                        </tr>
                        <tr class="priority-medium">
                            <td>優先度</td>
                            <td>中</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="test-case">
                <h3><span class="status-indicator status-completed"></span>TC005: Slack統合・通知テスト</h3>
                <div class="test-matrix">
                    <table>
                        <tr>
                            <th>項目</th>
                            <th>内容</th>
                        </tr>
                        <tr>
                            <td>目的</td>
                            <td>議事録要約とGoogle Drive録画リンクがSlackに正常投稿されることを確認</td>
                        </tr>
                        <tr>
                            <td>前提条件</td>
                            <td>Slack Bot Token設定済み、対象チャンネル権限設定済み</td>
                        </tr>
                        <tr>
                            <td>テスト手順</td>
                            <td>
                                1. sendMeetingSummaryWithRecording()を呼び出し<br>
                                2. Slackブロック形式メッセージの投稿確認<br>
                                3. 録画リンク・要約・参加者情報の表示確認<br>
                                4. 文字起こし全文ファイル添付確認
                            </td>
                        </tr>
                        <tr>
                            <td>期待結果</td>
                            <td>リッチメッセージ投稿成功、Google Driveリンクアクセス可能、適切な情報整理</td>
                        </tr>
                        <tr class="priority-high">
                            <td>優先度</td>
                            <td>高</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="test-case">
                <h3><span class="status-indicator status-completed"></span>TC006: 音声ファイル統合テスト（GoogleDrive → Gemini → Slack）</h3>
                <div class="test-matrix">
                    <table>
                        <tr>
                            <th>項目</th>
                            <th>内容</th>
                        </tr>
                        <tr>
                            <td>目的</td>
                            <td>GoogleDrive音声ファイル → Gemini要約 → Slack投稿の統合フローテスト</td>
                        </tr>
                        <tr>
                            <td>前提条件</td>
                            <td>GoogleDriveサンプルファイル、Gemini 2.5-pro、Slack本番環境</td>
                        </tr>
                        <tr>
                            <td>テスト手順</td>
                            <td>
                                1. https://drive.google.com/drive/folders/1U05EhOhWn91JMUINgF9de3kakdo9E_uX からM4A音声ファイル取得<br>
                                2. Gemini 2.5-proでaudio/aac形式で文字起こし・要約実行<br>
                                3. 本番Slackチャンネルに要約投稿<br>
                                4. 処理時間・エラーハンドリング確認
                            </td>
                        </tr>
                        <tr>
                            <td>実行結果</td>
                            <td>✅ 成功（2025-08-05 16:33実行）<br>
                                • 処理時間: 15秒<br>
                                • Gemini 2.5-pro音声処理: 正常動作<br>
                                • 要約生成: 高品質な日本語議事録<br>
                                • Slack投稿: リッチメッセージ投稿成功
                            </td>
                        </tr>
                        <tr class="priority-high">
                            <td>優先度</td>
                            <td>高</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="test-case">
                <h3><span class="status-indicator status-blocked"></span>TC007: 完全統合エンドツーエンドテスト</h3>
                <div class="test-matrix">
                    <table>
                        <tr>
                            <th>項目</th>
                            <th>内容</th>
                        </tr>
                        <tr>
                            <td>目的</td>
                            <td>5ステップ全体フローが順序通りに正常実行されることを確認</td>
                        </tr>
                        <tr>
                            <td>前提条件</td>
                            <td>全サービス（Zoom/Gemini/Drive/Slack）API設定完了</td>
                        </tr>
                        <tr>
                            <td>テスト手順</td>
                            <td>
                                1. processSingleRecording()で全フロー実行<br>
                                2. 各ステップの成功・失敗を監視<br>
                                3. エラーハンドリング・リトライ機能確認<br>
                                4. 処理時間・パフォーマンス測定
                            </td>
                        </tr>
                        <tr>
                            <td>期待結果</td>
                            <td>全ステップ完了、Slack投稿成功、Google Drive保存確認、一時ファイル削除</td>
                        </tr>
                        <tr class="priority-high">
                            <td>優先度</td>
                            <td>高</td>
                        </tr>
                        <tr class="priority-high">
                            <td>ブロック要因</td>
                            <td>Google Drive認証設定未完了のため実行不可</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>3. テストデータ</h2>
            
            <div class="test-data-section">
                <h4>📁 api/ テストAPIエンドポイント</h4>
                <ul>
                    <li><strong>health-check.js</strong> - 全サービスヘルスチェック
                        <ul>
                            <li>Zoom API認証テスト</li>
                            <li>Google AI API動的モデル選択テスト</li>
                            <li>Slack API接続テスト</li>
                            <li>Google Drive API認証テスト</li>
                        </ul>
                    </li>
                    <li><strong>test-google-ai-simple.js</strong> - Gemini APIテスト
                        <ul>
                            <li>利用可能モデル一覧取得</li>
                            <li>文字起こし機能テスト</li>
                            <li>要約生成機能テスト</li>
                        </ul>
                    </li>
                    <li><strong>録画テストデータ</strong> - 実際のZoom録画ファイル
                        <ul>
                            <li>短時間会議（5分、M4A音声）</li>
                            <li>長時間会議（30分、MP4動画）</li>
                            <li>複数話者会議（参加者3名以上）</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        
        <div class="section">
            <h2>4. 自動テスト</h2>
            
            <div class="automation-info">
                <h4>🔄 テスト自動化ツール</h4>
                <div class="test-matrix">
                    <table>
                        <tr>
                            <th>ツール</th>
                            <th>用途</th>
                            <th>実行タイミング</th>
                            <th>設定状況</th>
                        </tr>
                        <tr>
                            <td>Jest</td>
                            <td>ユニットテスト</td>
                            <td>コミット時、CI/CD</td>
                            <td><span class="status-indicator status-not-started"></span>未設定</td>
                        </tr>
                        <tr>
                            <td>Supertest</td>
                            <td>API統合テスト</td>
                            <td>CI/CD</td>
                            <td><span class="status-indicator status-not-started"></span>未設定</td>
                        </tr>
                        <tr>
                            <td>Playwright</td>
                            <td>E2Eテスト</td>
                            <td>週次、リリース前</td>
                            <td><span class="status-indicator status-not-started"></span>未設定</td>
                        </tr>
                        <tr>
                            <td>Artillery</td>
                            <td>負荷テスト</td>
                            <td>リリース前</td>
                            <td><span class="status-indicator status-not-started"></span>未設定</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <h3>📋 テスト実行スクリプト</h3>
            <div class="test-data-section">
                <h4>2.tests/tools/test-runners/ スクリプト構成</h4>
                <ul>
                    <li><strong>run-unit-tests.sh</strong> - ユニットテスト実行</li>
                    <li><strong>run-integration-tests.sh</strong> - 統合テスト実行</li>
                    <li><strong>run-e2e-tests.sh</strong> - E2Eテスト実行</li>
                    <li><strong>run-performance-tests.sh</strong> - 性能テスト実行</li>
                    <li><strong>run-all-tests.sh</strong> - 全テスト実行</li>
                </ul>
            </div>
        </div>
        
        <div class="section">
            <h2>5. テスト結果レポート</h2>
            
            <h3>実行結果サマリー</h3>
            <div class="test-matrix">
                <table>
                    <tr>
                        <th>テストタイプ</th>
                        <th>計画数</th>
                        <th>実行数</th>
                        <th>成功数</th>
                        <th>失敗数</th>
                        <th>成功率</th>
                        <th>状況</th>
                    </tr>
                    <tr>
                        <td>ユニットテスト</td>
                        <td>50</td>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                        <td>-</td>
                        <td><span class="status-indicator status-not-started"></span>未開始</td>
                    </tr>
                    <tr>
                        <td>統合テスト</td>
                        <td>20</td>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                        <td>-</td>
                        <td><span class="status-indicator status-not-started"></span>未開始</td>
                    </tr>
                    <tr>
                        <td>E2Eテスト</td>
                        <td>10</td>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                        <td>-</td>
                        <td><span class="status-indicator status-not-started"></span>未開始</td>
                    </tr>
                    <tr>
                        <td>性能テスト</td>
                        <td>5</td>
                        <td>0</td>
                        <td>0</td>
                        <td>0</td>
                        <td>-</td>
                        <td><span class="status-indicator status-not-started"></span>未開始</td>
                    </tr>
                </table>
            </div>
        </div>
        
        <div class="last-updated">
            最終更新: <span id="lastUpdated"></span> | 
            自動更新: <span id="autoUpdate">有効</span>
        </div>
    </div>
    
    
    <script>
        // 最終更新日時を設定
        document.getElementById('lastUpdated').textContent = new Date().toLocaleString('ja-JP');
        
        // Claude対話記録から自動更新
        async function checkForUpdates() {
            try {
                // Claude.mdファイルの内容を取得（実際の実装では、APIを通じて取得）
                const response = await fetch('/api/claude-status');
                if (response.ok) {
                    const data = await response.json();
                    
                    // 自動更新ステータスを表示
                    const autoUpdateEl = document.getElementById('autoUpdate');
                    if (autoUpdateEl) {
                        autoUpdateEl.textContent = '有効 (最終確認: ' + new Date().toLocaleTimeString('ja-JP') + ')';
                    }
                    
                    // 新しい変更があれば画面を更新
                    if (data.hasUpdates) {
                        console.log('新しい更新を検出しました。ページを再読み込みします。');
                        setTimeout(() => location.reload(), 2000);
                    }
                }
            } catch (error) {
                console.error('自動更新チェックエラー:', error);
            }
        }
        
        // 5分ごとに更新をチェック
        setInterval(checkForUpdates, 5 * 60 * 1000);
        
        // 初回チェック
        checkForUpdates();
    </script>

</body>
</html>